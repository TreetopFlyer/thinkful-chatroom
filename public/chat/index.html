<!doctype html>
<html>
    <head>
    <!--
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css" />
    -->
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular-route.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    </head>
    <body>
        <div ng-app="Chat">
            <div ng-controller="ControllerChat">

                <ul class="Members">
                    <li ng-repeat="member in members">
                        {{member.name}}
                    </li>
                </ul>
                
                <ul class="Messages">
                    <li ng-repeat="meta in chatMessages">
                        <strong>{{meta.alias}} :</strong>
                        <span>{{meta.message}}</span>
                    </li>
                </ul>
                
                <form ng-submit="aliasSubmit();">
                    <label for="Alias">Your Alias</label>
                    <input id="Alias" type="text" ng-model="aliasInput"/>
                    <button>send</button>
                </form>
                
                <form ng-submit="chatSubmit();">
                    <label for="Chat">Chat</label>
                    <input id="Chat" type="text" ng-model="chatInput"/>
                    <button>send</button>
                </form>
                
            </div>
        </div>
        
<script>
var Chat = angular.module("Chat", []);

Chat.factory("FactoryUser", [function(){
    var user = {};
    user.alias = 'anon';
    user.id = 0,
    user.message = '';
    return user;
}]);

Chat.controller("ControllerChat", ["$scope", "FactoryUser", function(inScope, inUser){
    var sockets = io();
    
    inScope.aliasInput = inUser.alias;
    inScope.aliasSubmit = function(){
        sockets.emit('alias', inScope.aliasInput);  
    };
    
    inScope.chatMessages = [];
    inScope.chatInput = inUser.message;
    inScope.chatSubmit = function(){
        inScope.chatMessages.push();
        sockets.emit('chat', inScope.chatInput); 
    };
    sockets.on('chat', function(inMessage){
        inScope.$apply(function(){
            inScope.chatMessages.push(inMessage);
        });
        console.log('message recieved', inScope.chatMessages);
    });
    
}]);
</script>
    </body>
</html>